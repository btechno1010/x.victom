<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
<style>
body{
  font-family:Cairo;
  background:#0b1d2a;
  color:#fff;
  padding:20px
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
  background:#132b3a
}
th,td{
  padding:10px;
  border:1px solid #1f4258;
  text-align:center
}
button{
  padding:6px 12px;
  border:none;
  background:#00e5ff;
  cursor:pointer;
  border-radius:6px;
  font-weight:bold
}
input{
  width:70px;
  padding:5px;
  text-align:center
}
</style>
</head>
<body>

<h2>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h2>

<table id="usersTable">
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
<th>Ø§Ù„ÙƒÙˆØ¯</th>
<th>Ø§Ù„Ø±ØµÙŠØ¯</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
</tr>
</table>

<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const auth = getAuth();

onAuthStateChanged(auth, async (user)=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  const docSnap = await getDoc(doc(db,"users",user.uid));
  const data = docSnap.data();

  if(!data || data.role !== "admin"){
    alert("ØºÙŠØ± Ù…ØµØ±Ø­ âŒ");
    window.location.href="login.html";
  }
});

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyD5qHSNK17JFLxUj_9mnKbb7XsYVSwb9u8",
  authDomain: "btechno-b5d80.firebaseapp.com",
  projectId: "btechno-b5d80",
  storageBucket: "btechno-b5d80.appspot.com",
  messagingSenderId: "147019806629",
  appId: "1:147019806629:web:bc7828be9ae8c4b4f1da4c",
  measurementId: "G-L7DYLWVHHJ"
};


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const table = document.getElementById("usersTable");

async function loadUsers(){
  const querySnapshot = await getDocs(collection(db,"users"));

  querySnapshot.forEach((docSnap)=>{
    const data = docSnap.data();
    const uid = docSnap.id;

    table.innerHTML += `
      <tr>
        <td>${data.name || "-"}</td>
        <td>${data.email || "-"}</td>
        <td>${data.userCode || "-"}</td>
        <td id="bal-${uid}">${data.balance || 0}</td>
        <td>
          <input type="number" id="input-${uid}" placeholder="+/-">
          <button onclick="updateBalance('${uid}')">Ø­ÙØ¸</button>
        </td>
      </tr>
    `;
  });
}

window.updateBalance = async function(uid){
  const value = Number(document.getElementById(`input-${uid}`).value);
  if(isNaN(value)) return alert("Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");

  const current = Number(document.getElementById(`bal-${uid}`).innerText);
  const newBalance = current + value;

  await updateDoc(doc(db,"users",uid),{
    balance:newBalance
  });

  document.getElementById(`bal-${uid}`).innerText = newBalance;
  alert("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
}

import { onSnapshot, collection } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

function loadUsers(){
  onSnapshot(collection(db,"users"),(snapshot)=>{
    table.innerHTML=`
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
        <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
        <th>ØªØ¹Ø¯ÙŠÙ„</th>
      </tr>
    `;

    snapshot.forEach((docSnap)=>{
      const data=docSnap.data();
      const uid=docSnap.id;

      table.innerHTML+=`
        <tr>
          <td>${data.name}</td>
          <td>${data.email}</td>
          <td id="bal-${uid}">${data.balance}</td>
          <td>
            <input type="number" id="input-${uid}">
            <button onclick="updateBalance('${uid}')">Ø­ÙØ¸</button>
          </td>
        </tr>
      `;
    });
  });
}

</script>

</body>
</html>

