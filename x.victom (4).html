<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X.VÃÄŒÃÃ˜M</title>

  
<style>
*{box-sizing:border-box;font-family:"Cairo",sans-serif}
body{
  margin:0;direction:rtl;
  background:url("https://images.unsplash.com/photo-1586773860418-d37222d8fce3?q=80&w=1600") center/cover fixed;
  color:#fff
}
.overlay{background:rgba(6,19,31,.9);min-height:100vh;padding-bottom:80px}
header{text-align:center;padding:20px}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:18px;padding:20px
}

.card{
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(12px);
  border-radius:20px;
  padding:15px;text-align:center;
  border:1px solid rgba(255,255,255,.2);
  box-shadow:0 10px 30px rgba(0,0,0,.4)
}
.card img{width:100%;height:120px;object-fit:contain}
.card button{
  padding:8px 12px;border:none;border-radius:20px;
  font-weight:bold;cursor:pointer;margin-top:5px
}
.card button[disabled]{background:#555;cursor:not-allowed}

.wallet{
  position:fixed;top:15px;right:15px;
  background:linear-gradient(135deg,#00e5ff,#0066ff);
  color:#000;padding:12px 18px;border-radius:40px;
  display:flex;gap:6px;align-items:center;
  font-weight:bold;z-index:1000;flex-wrap:wrap
}
.wallet button{
  border:none;background:#000;color:#00e5ff;
  padding:5px 10px;border-radius:20px;cursor:pointer;font-size:12px
}

.toast{
  position:fixed;top:-100px;right:50%;
  transform:translateX(50%);
  background:#e53935;color:#fff;
  padding:12px 25px;border-radius:30px;
  transition:.5s;z-index:4000
}
.toast.show{top:30px}

.modal{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff;color:#000;
  width:340px;border-radius:20px;
  padding:20px;text-align:center;
  display:none;z-index:5000
}
.modal button{
  margin-top:10px;padding:8px 15px;
  border:none;border-radius:20px;
  background:#0066ff;color:#fff;cursor:pointer
}
.modal input{
  width:100%;padding:10px;margin-top:10px;
  border-radius:15px;border:1px solid #ccc
}
</style>
</head>

<body>
<div class="overlay">

<div class="wallet">
ğŸ’° <span id="balance">0</span> Ø¬
<button onclick="dailyLogin()">ØªØ³Ø¬ÙŠÙ„</button>
<button onclick="toggleModal('withdrawBox')">Ø³Ø­Ø¨</button>
<button onclick="toggleModal('addBox')">Ø¥ÙŠØ¯Ø§Ø¹</button>
<button onclick="showTransactions()">Ø§Ù„Ø³Ø¬Ù„</button>
</div>

<header>
<h1>ğŸ¥ X.VÃÄŒÃÃ˜M</h1>
<p>Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø© | Ø£Ø±Ø¨Ø§Ø­ ÙŠÙˆÙ…ÙŠØ©</p>
</header>

<div class="container" id="products"></div>

<div class="modal" id="withdrawBox">
<h3>Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
<input type="number" id="withdrawAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<p>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: 230 Ø¬</p>
<button onclick="requestWithdraw()">Ø¥Ø±Ø³Ø§Ù„</button>
<button onclick="toggleModal('withdrawBox')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div class="modal" id="addBox">
<h3>Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹</h3>
<input type="number" id="addAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button onclick="addFunds()">Ø¥Ø±Ø³Ø§Ù„</button>
<button onclick="toggleModal('addBox')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  signInAnonymously, 
  onAuthStateChanged,
  setPersistence,
  browserLocalPersistence
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, setDoc, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5qHSNK17JFLxUj_9mnKbb7XsYVSwb9u8",
  authDomain: "btechno-b5d80.firebaseapp.com",
  projectId: "btechno-b5d80",
  storageBucket: "btechno-b5d80.appspot.com",
  messagingSenderId: "147019806629",
  appId: "1:147019806629:web:bc7828be9ae8c4b4f1da4c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* âœ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù‡Ù†Ø§ */
await setPersistence(auth, browserLocalPersistence);
signInAnonymously(auth);
/* âœ… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */

let currentUID=null;
let balance=0;
let transactions=[];

const products=[
  {id:1,name:"Ø¬Ù‡Ø§Ø² Ø¶ØºØ· Ø¯Ù…",price:900,img:"images2/Press.jpg"},
  {id:2,name:"Ø¬Ù‡Ø§Ø² ECG",price:2500,img:"images2/Ecg.jpg"},
  {id:3,name:"Ø¬Ù‡Ø§Ø² Ø£ÙƒØ³Ø¬ÙŠÙ†",price:1800,img:"images2/O2.jpg"},
  {id:4,name:"Ø¬Ù‡Ø§Ø² ØªÙ†ÙØ³ ØµÙ†Ø§Ø¹ÙŠ",price:4500,img:"images2/Tanafs.jpg"},
  {id:5,name:"Ø³Ø±ÙŠØ± Ø·Ø¨ÙŠ",price:4000,img:"images2/Sereer.jpg"},
  {id:6,name:"Ø¬Ù‡Ø§Ø² Ø£Ø´Ø¹Ø©",price:5200,img:"images2/Seen.jpg"},
  {id:7,name:"Ø¬Ù‡Ø§Ø² Ø´ÙØ·",price:1500,img:"images2/Shaft.jpg"},
  {id:8,name:"Ø¬Ù‡Ø§Ø² Ø³ÙƒØ±",price:700,img:"images2/Sugar.jpg"}
];

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  currentUID=user.uid;
  const ref=doc(db,"users",currentUID);

  const snap=await getDoc(ref);
  if(!snap.exists()){
    await setDoc(ref,{balance:0,transactions:[],rented:{}});
  }

  onSnapshot(ref,s=>{
    const d=s.data();
    balance=d.balance||0;
    transactions=d.transactions||[];
    document.getElementById("balance").innerText=balance;
    renderProducts(d.rented||{});
  });
});

function renderProducts(rented){
  const c=document.getElementById("products");
  c.innerHTML="";
  products.forEach(p=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <img src="${p.img}">
      <h4>${p.name}</h4>
      <p>${p.price} Ø¬</p>
      <p style="color:#00c853">Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ ${(p.price*0.23).toFixed(0)} Ø¬</p>
    `;
    const b=document.createElement("button");
    b.textContent=rented[p.id]?"ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠØ±":"ØªØ£Ø¬ÙŠØ±";
    b.disabled=rented[p.id];
    b.onclick=()=>rentProduct(p.id,p.price);
    d.appendChild(b);
    c.appendChild(d);
  });
}

async function rentProduct(id,price){
  const ref=doc(db,"users",currentUID);
  const snap=await getDoc(ref);
  const bal=snap.data().balance;
  if(bal<price) return showToast("âŒ Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ");

  await updateDoc(ref,{
    balance:bal-price,
    [`rented.${id}`]:true,
    transactions:arrayUnion({type:"ØªØ£Ø¬ÙŠØ±",amount:-price,date:Date.now()})
  });
  showToast("âœ… ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠØ±");
}

async function dailyLogin(){
  const ref=doc(db,"users",currentUID);
  const snap=await getDoc(ref);
  const tx=snap.data().transactions||[];
  const last=tx.filter(t=>t.type==="Ù…ÙƒØ§ÙØ£Ø©").pop()?.date||0;
  if(Date.now()-last<86400000) return showToast("â³ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©");

  await updateDoc(ref,{
    balance:snap.data().balance+40,
    transactions:arrayUnion({type:"Ù…ÙƒØ§ÙØ£Ø©",amount:40,date:Date.now()})
  });
  showToast("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ");
}

async function requestWithdraw(){
  const a=+withdrawAmount.value;
  const ref=doc(db,"users",currentUID);
  const snap=await getDoc(ref);
  if(a<230||a>snap.data().balance) return showToast("âŒ Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­");

  await updateDoc(ref,{
    balance:snap.data().balance-a,
    transactions:arrayUnion({type:"Ø³Ø­Ø¨",amount:-a,date:Date.now()})
  });
  window.location.href=`mailto:btechno1010@gmail.com?subject=Ø·Ù„Ø¨ Ø³Ø­Ø¨&body=Ø§Ù„Ù…Ø¨Ù„Øº:${a}`;
}

async function addFunds(){
  const a=+addAmount.value;
  if(a<=0) return;
  const ref=doc(db,"users",currentUID);
  const snap=await getDoc(ref);
  await updateDoc(ref,{
    balance:snap.data().balance+a,
    transactions:arrayUnion({type:"Ø¥ÙŠØ¯Ø§Ø¹",amount:a,date:Date.now()})
  });
  window.location.href=`mailto:btechno1010@gmail.com?subject=Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹&body=Ø§Ù„Ù…Ø¨Ù„Øº:${a}`;
}

function showTransactions(){
  alert(transactions.map(t=>`${new Date(t.date).toLocaleString()} | ${t.type} | ${t.amount}`).join("\n"));
}

function toggleModal(id){
  const m=document.getElementById(id);
  m.style.display=m.style.display==="block"?"none":"block";
}

function showToast(m){
  const t=document.getElementById("toast");
  t.innerText=m;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),3000);
}

window.dailyLogin=dailyLogin;
window.requestWithdraw=requestWithdraw;
window.addFunds=addFunds;
window.showTransactions=showTransactions;
window.toggleModal=toggleModal;
</script>

</div>
</body>
</html>
